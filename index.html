<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TT Space Rocks</title>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        body {
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background: black;
        }
        #pontuacao {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 24px;
            font-family: Arial, sans-serif;
            display: none;
        }
        #tela-inicial, #tela-game-over { /* css das telas inicial e de game over */
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.9);
        }
        #tela-game-over { /* css especifico da game over, pra que não apareça no inicio */
            display: none;
        }
        canvas { /* oculta o canvas para que apareça apenas a tela de inicio */
            display: none;
        }
        .btn {
            width: 200px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div id="pontuacao">Pontos: 0</div>

    <div id="tela-inicial">
        <img src="imagens/titulo.png" alt="Título do jogo"> <!-- Coleta a imagem do diretório "imagens"-->
        <img id="start-btn" class="btn" src="imagens/botao.png" alt="Botão Iniciar"> <!-- Coleta a imagem do diretório "imagens"-->
    </div>

    <div id="tela-game-over">
        <img src="imagens/gameover.png" alt="Game Over"> <!-- Coleta a imagem do diretório "imagens"-->
        <img id="restart-btn" class="btn" src="imagens/botao.png" alt="Botão Reiniciar"> <!-- Coleta a imagem do diretório "imagens"-->
    </div>

    <canvas></canvas>

    <script>
        const width = window.innerWidth; // Se adequa a largura da tela da máquina
        const height = window.innerHeight; // Se adequa a altura da tela da máquina
        const canvas = document.querySelector('canvas'); // Armazena o canvas em uma constante
        canvas.width = width; // Iguala a largura do canvas à largura da janela da máquina
        canvas.height = height; // Iguala a altura do canvas à altura da janela da máquina
        const c = canvas.getContext('2d'); // Armazenamento do 2d do canvas em uma constante, permite desenhar formas, textose e imagens e muito mais no canvas

        let jogoIniciado = false;
        let gameOver = false;
        let rochas = [];
        let tiros = [];
        const estado = { pontos: 0 }; // Constante que armazena os pontos (em forma de objeto)
        let navePos = { x: width / 2 - 50, y: height - 100 };

        const rochaImg = new Image();
        rochaImg.src = 'imagens/stone_PNG13556.png';
        const naveImg = new Image();
        naveImg.src = 'imagens/Spaceship-PNG-File.png';

        function atualizarPontuacao() { // Função para atualizar a pontuação sempre que ela mudar
            document.getElementById('pontuacao').innerText = `Pontos: ${estado.pontos}`;
        }

        function iniciarJogo() { 
            document.getElementById("tela-inicial").style.display = "none";
            document.getElementById("tela-game-over").style.display = "none";
            canvas.style.display = "block"; // Torna visível o canvas
            document.getElementById('pontuacao').style.display = "block";
            jogoIniciado = true;
            gameOver = false;
            estado.pontos = 0; // Começa com 0 pontos
            atualizarPontuacao(); // chama a função de atualizar
            rochas = Array.from({ length: 5 }, () => ({ x: Math.random() * (width - 50), y: 0 }));
            tiros = [];
            animate();
        }
        
        function mostrarGameOver() {
            gameOver = true;
            document.getElementById("tela-game-over").style.display = "flex"; // Permite exibir a tela de gameover
            canvas.style.display = "none";
            document.getElementById('pontuacao').style.display = "none";
        }


        function atirar() {
            if (!gameOver) {
                tiros.push({ x: navePos.x + 45, y: navePos.y - 20, width: 10, height: 20, speed: 5 });
            }
        }

        function adicionarPontos() { // função simples para adicionar os pontos
            estado.pontos += 10;
            atualizarPontuacao();
        }

        function animate() {
            if (!jogoIniciado || gameOver) return;
            requestAnimationFrame(animate);
            c.fillStyle = 'black';
            c.fillRect(0, 0, width, height);

            rochas.forEach(rocha => { // agora as rochas apareçem de forma funcional
                rocha.y += 1;
                if (rocha.y > height) {
                    rocha.y = 0;
                    rocha.x = Math.random() * (width - 50);
                }
                c.drawImage(rochaImg, rocha.x, rocha.y, 50, 50);
                if (checkCollision(navePos, rocha)) {
                    mostrarGameOver();
                }
            });

            c.drawImage(naveImg, navePos.x, navePos.y, 100, 100);

            //Checagem dos tiros e criação deles agora é 100% funcional, utilizando map e filter
            tiros = tiros.map(tiro => {
            const novoTiro = { ...tiro, y: tiro.y - tiro.speed };

            c.fillStyle = 'red';
            c.fillRect(novoTiro.x, novoTiro.y, novoTiro.width, novoTiro.height);

            // Verifica colisão com cada rocha
            rochas.forEach((rocha, index) => {
                if (checkCollision(novoTiro, rocha)) {
                    rochas[index] = {
                        x: Math.random() * (width - 50),
                        y: 0
                    };
                    adicionarPontos();
                    novoTiro.hit = true;
                }
            });

            return novoTiro;
        })
        .filter(tiro => tiro.y > 0 && !tiro.hit);
}

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + 50 &&
                   rect1.x + 100 > rect2.x &&
                   rect1.y < rect2.y + 50 &&
                   rect1.y + 100 > rect2.y;
        }

        window.addEventListener('keydown', function(e) {
            if (!jogoIniciado || gameOver) return;
            if (e.key === 'ArrowRight' && navePos.x < width - 100) navePos.x += 40;
            if (e.key === 'ArrowLeft' && navePos.x > 5) navePos.x -= 40;
            if (e.key === ' ' || e.key === 'Spacebar') atirar();
        });

        document.getElementById('start-btn').addEventListener('click', iniciarJogo);
        document.getElementById('restart-btn').addEventListener('click', iniciarJogo);
    </script>
</body>
</html>